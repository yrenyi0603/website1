
<form id="fm" method="post" data-options="novalidate:true">
    {% comment "Optional note1" %}
    {% for field  in form %}

    <div style="margin-bottom:20px">
        <label for="{{ field.id_for_label }}"  >{{ field.label|upper  }}:  </label>{{  field }}
    </div>
    {% endfor %}
    {% endcomment %}

    <table id="edittalbe" cellpadding="5" style="width:100%;max-width:400px" class="td">
        {% for field  in form.visible_fields  %}
        <tr >
            <td style="width:20%;float:left" >
                <label for="{{ field.id_for_label }}"  >{{ field.label|upper  }}:  </label>
            </td>
            <td style="float:left" >
                {{  field }}
            </td>
        </tr>
        {% endfor %}
    </table>
    	<style scoped="scoped">
    	.td{
    	    white-space:nowrap;
    	}
		.tb{
			width:100%;
			margin:0;
			padding:5px 4px;
			border:1px solid #ccc;
			box-sizing:border-box;
		}
	</style>
    <script Language=JavaScript>
    $.extend($.fn.validatebox.defaults.rules, {
    ipaddress: {
        validator: function(value){
            var reg = /^((1?\d?\d|(2([0-4]\d|5[0-5])))\.){3}(1?\d?\d|(2([0-4]\d|5[0-5])))$/ ;
            return reg.test(value);
        },
        message: 'Please enter valid ip address.'
    },
    phone:{
        validator: function(value){
            var reg = /^1[3|4|5|8|9]\d{9}$/;
            return reg.test(value);
        },
        message: 'Please enter valid phone number.'
    },

    });
    </script>
    {% if form.mtype.value == 'mailcheck' or  form.mtype.value == 'powercheck' %}
        <div id="chosestaffs" class="easyui-dialog" style="height:400px;width:100%;max-width:400px;padding:10px 40px 20px 40px;"
				closed="true" buttons="#chosestaff-buttons">
            <div class="easyui-panel" style="padding:5px;width:100%;max-width:300px">
                <ul id="ttcheck" class="easyui-tree" data-options="
                    {% if form.mtype.value == 'mailcheck'  %}
                        url:'{% url 'emailtree' %}',
                    {% else %}
                        url:'{% url 'iptree' %}',
                    {% endif %}
                    method:'get',
                    animate:true,
                    checkbox:true,
                    onlyLeafCheck:true,
                    formatter:function(node){
                                    var s = node.text;
                                    if (node.children){
                                        s += '&nbsp;<span style=\'color:blue\'>(' + node.children.length + ')</span>';
                                    }
                                    return s;
                                }
                    ">
                </ul>
            </div>
		</div>
        <div id="chosestaff-buttons">
			<!--
			<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()" style="width:80px">Clear</a>
			-->

			<a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="addchose()">Chose</a>
			<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#chosestaffs').dialog('close')">Cancel</a>

		</div>
        <a href="#" class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="chosestaff()">从员工列表中选择</a>

        <script Language=JavaScript>
            $(document).ready(function(){
                {% if form.mtype.value == 'mailcheck'  %}
                    //$("input#{{ form.email.id_for_label }}").removeAttr("required");
                    //$("textarea#{{ form.staffemails.id_for_label }}").removeAttr("required");
                    var tr='<tr><td style="width:20%;float:left">{{ form.staffemails.label_tag }}</td><td style="float:left"><textarea   id="{{ form.staffemails.id_for_label }}" class="easyui-textbox" multiline="true" name="{{ form.staffemails.html_name }}"  value="" style="width:100%;height:80px;"></textarea></td></tr>';
                {% else %}
                    var tr='<tr><td style="width:20%;float:left">{{ form.staffipadderss.label_tag }}</td><td style="float:left"><textarea id="{{ form.staffipadderss.id_for_label }}"  class="easyui-textbox" multiline="true" name="{{ form.staffipadderss.html_name }}" value="" style="width:100%;height:80px;"></textarea></td></tr>';
                    //$("input#{{ form.ipaddress.id_for_label }}").removeAttr("required");
                    //$("textarea#{{ form.staffipadderss.id_for_label }}").removeAttr("required");
                {% endif %}
                $("#edittalbe").append(tr);
            });
            function chosestaff(){
                $('#chosestaffs').dialog({
                    title:'员工tree',
                    width:500,
                    heigth:200,
                    closed:false,
                    cache:false,
                    modal:true,
                    onBeforeOpen:function(){
                        $("#ttcheck").tree('reload');
                    },
                });
                //$('#chosestaff').dialog('open').dialog('setTitle','员工列表');
                //url = '{{ url.addurl }}';
                //pk="";
            };
            function addchose(){

                var nodes = $('#ttcheck').tree('getChecked');

                var s = '';
                for(var i=0; i<nodes.length; i++){
                    if (s != '') s += ',';
                    s += nodes[i].text;
                }
                if(s!='wosign'){

                    {% if form.mtype.value == 'mailcheck'  %}
                        $("textarea#{{ form.staffemails.id_for_label }}").textbox('setValue',s);
                    {% else %}
                        $("textarea#{{ form.staffipadderss.id_for_label }}").textbox('setValue',s);
                    {% endif %}
                }
                $('#chosestaffs').dialog('close');
                //alert("input{{ form.staffemails.html_name }}");
                //alert($("[name={{ form.staffemails.html_name }}]").val());
                //$("{{ form.staffemails.html_name }}").val('111111111111111');
                //$("[name={{ form.staffemails.html_name }}]").val(s);
                //$("[name={{ form.staffemails.html_name }}]").prev().html(s)
                //$("input#{{ form.staffemails.id_for_label }}").next("span").children("textarea").html(s);
                //alert($("[name={{ form.staffemails.html_name }}]").val());
                //alert($("input#{{ form.staffemails.id_for_label }}").next("span").children("textarea").html())
                //$("textarea#{{ form.staffemails.id_for_label }}").textbox('setValue',s);
                //alert($("textarea#{{ form.staffemails.id_for_label }}").textbox())
            };
        </script>
    {% endif %}
</form>
